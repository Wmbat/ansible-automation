---
- name: "Épicerie Le Détour Ansible playbook"
  hosts: webservers
  become: true
  tasks:
    - name: Upgrade all packages
      apt:
        name: "*"
        state: latest

    - name: Install needed packages
      apt:
        pkg:
          - git
          - nginx
          - rsync
          - wget
          - ufw
          - python3
          - unattended-upgrades
          - adduser
          - libfontconfig1

    - name: Fetching public keys
      import_tasks: tasks/fetching_keys.yml

    - name: Setting up firewall
      import_tasks: tasks/firewall.yml

    - name: Setting up unattended upgrades
      import_tasks: tasks/unattended_upgrades.yml

    - name: Setting up Grafana
      import_tasks: tasks/grafana.yml
