---
- name: "Épicerie Le Détour Ansible playbook"
  hosts: webservers
  become: true
  tasks:
    - name: Upgrade all packages
      apt:
        name: "*"
        state: latest

    - name: Install needed packages
      apt:
        pkg:
          - git
          - nginx
          - rsync
          - wget

    - name: Download charlesfleche keys
      get_url: 
        url: https://github.com/charlesfleche.keys
        dest: .

    - name: Download mauriandres keys
      get_url: 
        url: https://github.com/mauriandres.keys 
        dest: .

    - name: Download Wmbat keys
      get_url:
        url: https://github.com/Wmbat.keys 
        dest: .

    - name: Setup authorized public keys
      shell: cat charlesfleche.keys mauriandres.keys Wmbat.keys > .ssh/authorized_keys

    - name: Cleanup
      shell: rm -f $(ls | grep ".keys")
